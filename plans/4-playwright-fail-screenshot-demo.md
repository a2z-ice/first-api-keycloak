# Plan 4: Playwright Fail-Screenshot Demo

> **Plan Name**: playwright-fail-screenshot-demo
> **Created**: 2026-02-17
> **Status**: Implemented

---

## Summary

Isolated demonstration that Playwright captures screenshots on test failure and includes them in the HTML report. This adds:
- A **single deliberately-failing test** in a separate test directory
- A **dedicated Playwright config** with `screenshot: 'only-on-failure'` enabled
- A **shell script** that runs the failing test and verifies screenshots are captured
- Completely isolated from the main test suite — no existing files modified

## Key Configuration

| Item | Value |
|------|-------|
| Test Directory | `frontend/tests/e2e-fail-demo/` |
| Playwright Config | `frontend/playwright-fail-demo.config.ts` |
| Report Folder | `frontend/playwright-fail-demo-report/` |
| Screenshot Setting | `only-on-failure` |
| Screenshot Output | `frontend/test-results/` (Playwright default) |
| Runner Script | `scripts/test-fail-screenshot.sh` |

## Why a Separate Config

The main `playwright.config.ts` does not set `screenshot` (defaults to `off`). Rather than modifying the main config and affecting all 46+ tests, this demo uses its own config file (`playwright-fail-demo.config.ts`) that:
- Points `testDir` to `tests/e2e-fail-demo/` (not `tests/e2e/`)
- Outputs reports to `playwright-fail-demo-report/` (not `playwright-report/`)
- Sets `screenshot: 'only-on-failure'`
- Has `retries: 0` so the failure is immediate

## Architecture

```
scripts/test-fail-screenshot.sh
    |
    v
npx playwright test --config playwright-fail-demo.config.ts
    |
    ├── testDir: tests/e2e-fail-demo/
    │       └── fail-demo.spec.ts         (deliberately fails)
    │
    ├── screenshot: 'only-on-failure'
    │       └── test-results/*.png        (captured on failure)
    │
    └── reporter: html
            └── playwright-fail-demo-report/index.html
```

**Main test suite is unaffected:**
```
npx playwright test                          ← uses playwright.config.ts
    └── testDir: tests/e2e/                  ← original 46+ tests
```

## How the Failing Test Works

`fail-demo.spec.ts` navigates to the app root (redirects to login page), then asserts that a non-existent element (`h1` with text "This Element Does Not Exist") is visible. This assertion times out after 5 seconds and fails, triggering Playwright's screenshot capture.

## Script Workflow

`scripts/test-fail-screenshot.sh` runs 4 steps:

| Step | Action | Verification |
|------|--------|-------------|
| 1 | Health check | `curl $APP_URL/api/health` returns 200 |
| 2 | Clean artifacts | Remove previous `playwright-fail-demo-report/` and `test-results/` |
| 3 | Run failing test | Exit code ≠ 0 (test must fail) |
| 4 | Verify screenshot | At least one `.png` exists in `test-results/` |

## Usage

```bash
# Run with deployed app (default APP_URL=http://localhost:30000)
./scripts/test-fail-screenshot.sh

# Run with custom URL
APP_URL=http://localhost:30000 ./scripts/test-fail-screenshot.sh

# View the failure report (includes embedded screenshot)
cd frontend && npx playwright show-report playwright-fail-demo-report
```

## Files Created

| File | Purpose |
|------|---------|
| `frontend/tests/e2e-fail-demo/fail-demo.spec.ts` | Single test that deliberately fails to trigger screenshot |
| `frontend/playwright-fail-demo.config.ts` | Isolated Playwright config with `screenshot: 'only-on-failure'` |
| `scripts/test-fail-screenshot.sh` | Runner script: executes test, verifies screenshot exists |

## Files Modified

| File | Change |
|------|--------|
| `.gitignore` | Added `frontend/playwright-fail-demo-report/` to ignore auto-generated report |
| `CLAUDE.md` | Added fail-screenshot demo section, script reference, and gitignore note |
| `README.md` | Added full fail-screenshot demo documentation, updated project structure and scripts reference |

## Auto-Generated Artifacts (git-ignored)

| Artifact | Generated By | Git-Ignored |
|----------|-------------|-------------|
| `frontend/playwright-fail-demo-report/` | Playwright HTML reporter | Yes (`.gitignore`) |
| `frontend/test-results/` | Playwright screenshot capture | Yes (`.gitignore`, already existed) |

## Lessons Learned

1. **Playwright `screenshot` default is `'off'`**: The main config doesn't capture screenshots on failure. To enable it, set `use.screenshot: 'only-on-failure'` in the config.
2. **Screenshots land in `test-results/`**: Playwright saves failure screenshots under the `test-results/` directory (relative to the config file), not in the report folder. The HTML report embeds them as base64.
3. **Isolation via `--config` flag**: Running `npx playwright test --config <file>` uses a completely separate configuration, so demo tests never interfere with the main suite.
